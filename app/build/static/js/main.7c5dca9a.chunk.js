(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[0],{40:function(e,t,a){e.exports=a(80)},68:function(e,t,a){},79:function(e,t,a){},80:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(36),i=a(11),s=a(12),l=a(14),c=a(13),u=a(19),d=a(2),m=a(39),h=["component"],p=function(e){var t=e.component,a=Object(m.a)(e,h);return r.a.createElement(d.b,Object.assign({},a,{render:function(e){return localStorage.getItem("user")?r.a.createElement(t,e):r.a.createElement(d.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},f=a(4),g=a(20),v=a(1),b=a.n(v),y=a(5),w=a(10),E=a(18),A=a.n(E),k=(a(68),a(69),a(73),function(e){Object(l.a)(a,e);var t=Object(c.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={loadingDownloadLink:!1,downloadLink:!1,downloadLeadNumber:null,downloadData:[]},e}return Object(s.a)(a,[{key:"render",value:function(){return r.a.createElement("div",null)}}]),a}(n.Component)),P="https://map247.razrlab.com/api/group",x=function(e){Object(l.a)(n,e);var t=Object(c.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={newPolygon:!1,editPolygonDetails:{name:"",layer:null},tableData:{columns:["name"],rows:[]},currentPolygonsInView:[],currentPolygonLabels:[]},e}return Object(s.a)(n,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",{id:"map"}),r.a.createElement("div",{id:"sidebar"},!this.state.newPolygon&&!this.state.editPolygon&&r.a.createElement("div",null,r.a.createElement("h3",null,"Groups"),r.a.createElement(k,{data:this.state.tableData,handleShow:this.handleShow.bind(this),handleEdit:this.handleEdit.bind(this),handleDelete:this.handleDelete.bind(this)}),r.a.createElement("button",{className:"btn btn-primary",onClick:function(){e.createNewPolygon()}},"Create New")),this.state.newPolygon&&r.a.createElement("div",null,r.a.createElement("div",{className:"row",style:{marginTop:"5vh"}},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{for:"exampleInputEmail1"},"Group Name"),r.a.createElement("input",{type:"text",className:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",placeholder:"Enter Name",value:this.state.editPolygonDetails.name,onChange:function(t){e.setState({editPolygonDetails:Object(w.a)(Object(w.a)({},e.state.editPolygonDetails),{},{name:t.target.value})})}}),r.a.createElement("small",{id:"emailHelp",className:"form-text text-muted"},"Please enter a unqiue group name.")),r.a.createElement("button",{className:"btn btn-dark",onClick:function(){e.submitNewPolygon()}},"Save")," ",r.a.createElement("button",{className:"btn btn-danger",onClick:function(){e.cancelNewPolygon()}},"Cancel"))),this.state.editPolygon&&r.a.createElement("div",null,r.a.createElement("div",{className:"row",style:{marginTop:"5vh"}},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{for:"exampleInputEmail1"},"Group Name"),r.a.createElement("input",{type:"text",className:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",placeholder:"Enter Name",value:this.state.editPolygonDetails.name,onChange:function(t){e.setState({editPolygonDetails:Object(w.a)(Object(w.a)({},e.state.editPolygonDetails),{},{name:t.target.value})})}}),r.a.createElement("small",{id:"emailHelp",className:"form-text text-muted"},"Please enter a unqiue group name.")),r.a.createElement("button",{className:"btn btn-dark",onClick:function(){e.submitEditedPolygon()}},"Save")," ",r.a.createElement("button",{className:"btn btn-danger",onClick:function(){e.cancelEditedPolygon()}},"Cancel")))))}},{key:"componentDidMount",value:function(){this.run()}},{key:"handleShow",value:function(e){var t=e.target.value,a=e.target.checked,n=this.state.tableData.rows.find((function(e){return t.toString()===e._id.toString()}));n&&n.layer&&this.renderSelectedPolygon(n,a)}},{key:"handleEdit",value:function(){var e=Object(y.a)(b.a.mark((function e(t){var a,n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.target.value,n=!0,!(r=this.state.tableData.rows.find((function(e){return a.toString()===e._id.toString()})))||!r.layer){e.next=11;break}return e.next=6,this.removeAllPolygonsFromMap();case 6:return e.next=8,this.renderSelectedPolygon(r,n);case 8:this.enablePolygonEditControl(),this.editableLayers.addLayer(r.layer),this.setState({editPolygon:!0,editPolygonDetails:{_id:a,name:r.name,layer:r.layer}});case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleDelete",value:function(){var e=Object(y.a)(b.a.mark((function e(t){var a,n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.target.value,!window.confirm("Are you sure you want to delete?")){e.next=17;break}return e.prev=3,!1,(n=this.state.tableData.rows.find((function(e){return a.toString()===e._id.toString()})))&&n.layer&&this.renderSelectedPolygon(n,!1),e.next=9,this.deleteGroup(n);case 9:e.sent&&(r=this.state.tableData.rows.filter((function(e){return e._id&&a&&e._id.toString()!==a.toString()})),this.setState({tableData:Object(w.a)(Object(w.a)({},this.state.tableData),{},{rows:r})})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(3),console.error(e.t0),alert("An error occurred while deleting...");case 17:case"end":return e.stop()}}),e,this,[[3,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"renderSelectedPolygon",value:function(){var e=Object(y.a)(b.a.mark((function e(t,a){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.layer){e.next=9;break}if(n=t.layer,!a){e.next=7;break}return e.next=5,this.addPolygonAndLabelToMap(t,n);case 5:e.next=9;break;case 7:return e.next=9,this.removePolygonAndLabelFromMap(t,n);case 9:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"addPolygonAndLabelToMap",value:function(e,t){var a=this;return new Promise((function(n){t._parentId=e._id,t.addTo(a.mapElement);var r=new window.L.Label;r.setContent(e.name),r.setLatLng(t.getBounds().getCenter()),r._parentId=e._id,t.bindLabel(r),a.mapElement.showLabel(r),a.setState((function(e){return{currentPolygonsInView:[].concat(Object(g.a)(e.currentPolygonsInView),[t]),currentPolygonLabels:[].concat(Object(g.a)(e.currentPolygonLabels),[r])}})),n()}))}},{key:"removePolygonAndLabelFromMap",value:function(e,t){var a=this;return new Promise((function(n){var r=a.state.currentPolygonLabels.find((function(t){return t._parentId&&e._id&&t._parentId.toString()===e._id.toString()}));r&&a.mapElement.removeLayer(r),t&&a.mapElement.removeLayer(t);var o=a.state.currentPolygonsInView.filter((function(e){return e._parentId&&r._parentId&&e._parentId.toString()!==r._parentId.toString()})),i=a.state.currentPolygonLabels.filter((function(e){return e._parentId&&r._parentId&&e._parentId.toString()!==r._parentId.toString()}));a.setState({currentPolygonsInView:o,currentPolygonLabels:i}),n()}))}},{key:"removeAllPolygonsFromMap",value:function(){var e=this;return new Promise((function(t,a){e.state.currentPolygonsInView.forEach((function(t){e.mapElement.removeLayer(t)})),e.state.currentPolygonLabels.forEach((function(t){e.mapElement.removeLayer(t)})),e.setState({currentPolygonsInView:[],currentPolygonLabels:[]}),t()}))}},{key:"createNewPolygon",value:function(){var e=Object(y.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.removeAllPolygonsFromMap();case 2:this.setState({newPolygon:!0}),this.enablePolygonEditControl();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"submitNewPolygon",value:function(){var e=Object(y.a)(b.a.mark((function e(){var t,a=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,""===this.state.editPolygonDetails.name||!this.state.editPolygonDetails.layer){e.next=21;break}if(!this.state.tableData.rows.find((function(e){return e.name===a.state.editPolygonDetails.name}))){e.next=6;break}return alert("Name already exists"),e.abrupt("return");case 6:return e.next=8,this.saveGroup(this.state.editPolygonDetails);case 8:if(!(t=e.sent)){e.next=18;break}return e.next=12,this.addNewPolygon(t);case 12:return this.resetForm(),this.disablePolygonEditControl(),e.next=16,this.removeAllPolygonsFromMap();case 16:e.next=19;break;case 18:throw new Error("new polygon not returned");case 19:e.next=22;break;case 21:alert("Please input a valid name and shape");case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(0),console.log(e.t0),alert("An error occurred while editing");case 28:case"end":return e.stop()}}),e,this,[[0,24]])})));return function(){return e.apply(this,arguments)}}()},{key:"submitEditedPolygon",value:function(){var e=Object(y.a)(b.a.mark((function e(){var t,a=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,""===this.state.editPolygonDetails.name||!this.state.editPolygonDetails.layer){e.next=21;break}if(!this.state.tableData.rows.find((function(e){return e.name===a.state.editPolygonDetails.name&&e._id.toString()!==a.state.editPolygonDetails._id.toString()}))){e.next=6;break}return alert("Name already exists"),e.abrupt("return");case 6:return e.next=8,this.updateGroup(this.state.editPolygonDetails);case 8:if(!(t=e.sent)){e.next=18;break}return e.next=12,this.addEditedPolygon(t);case 12:return this.resetForm(),this.disablePolygonEditControl(),e.next=16,this.removeAllPolygonsFromMap();case 16:e.next=19;break;case 18:throw new Error("new polygon not returned");case 19:e.next=22;break;case 21:alert("Please input a valid name and shape");case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(0),console.error(e.t0),alert("An error occurred while editing");case 28:case"end":return e.stop()}}),e,this,[[0,24]])})));return function(){return e.apply(this,arguments)}}()},{key:"addNewPolygon",value:function(e){var t=this;return new Promise((function(a,n){t.setState({tableData:{rows:[].concat(Object(g.a)(t.state.tableData.rows),[{_id:e._id,name:e.name,layer:e.layer?e.layer:window.L.GeoJSON.geometryToLayer(e.geoJSON)}])}}),a()}))}},{key:"addEditedPolygon",value:function(e){var t=this;return new Promise((function(e,a){var n=t.state.tableData.rows.map((function(e){return t.state.editPolygonDetails._id.toString()===e._id.toString()?Object.assign(e,{name:t.state.editPolygonDetails.name,layer:t.state.editPolygonDetails.layer}):e}));t.setState({tableData:{rows:n}}),e()}))}},{key:"cancelNewPolygon",value:function(){this.resetForm(),this.removeAllPolygonsFromMap(),this.disablePolygonEditControl()}},{key:"cancelEditedPolygon",value:function(){this.resetForm(),this.removeAllPolygonsFromMap(),this.disablePolygonEditControl()}},{key:"resetForm",value:function(){this.setState({newPolygon:!1,editPolygon:!1,editPolygonDetails:{name:"",layer:null}})}},{key:"run",value:function(){var e=Object(y.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.onLoad();case 2:return this.addControls(),e.next=5,this.getGroups();case 5:(t=e.sent)&&t.length&&this.populateGroups(t);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"populateGroups",value:function(e){if(e&&e.length){var t=e.filter((function(e){return e.name&&e.geoJSON&&e._id})).map((function(e){return e.layer=window.L.GeoJSON.geometryToLayer(e.geoJSON),e}));this.setState({tableData:Object(w.a)(Object(w.a)({},this.state.tableData),{},{rows:t})})}}},{key:"getGroups",value:function(){return new Promise((function(e,t){A.a.get(P).then((function(a){a&&a.data&&a.data.data?e(a.data.data):t(new Error("There is no data")),e()})).catch((function(e){t(e)}))}))}},{key:"saveGroup",value:function(e){return new Promise((function(t,a){if(e&&e&&e.layer&&e.name&&e.layer.toGeoJSON()&&e.layer.toGeoJSON().geometry){var n=Object.assign({},e);n.geoJSON||(n.geoJSON=n.layer.toGeoJSON().geometry,delete n.layer),A.a.post(P,n).then((function(e){e&&e.data&&e.data.data?t(e.data.data):a(new Error("There is no data"))})).catch((function(e){a(e)}))}else a(new Error("Insufficient parameters are being sent"))}))}},{key:"updateGroup",value:function(e){return new Promise((function(t,a){if(e&&e&&e.layer&&e.name&&e.layer.toGeoJSON()&&e.layer.toGeoJSON().geometry){var n=Object.assign({},e);n.geoJSON||(n.geoJSON=n.layer.toGeoJSON().geometry,delete n.layer),A.a.put(P,n).then((function(e){e&&e.data&&e.data.data?t(e.data.data):a(new Error("There is no data"))})).catch((function(e){a(e)}))}else a(new Error("Insufficient parameters are being sent"))}))}},{key:"deleteGroup",value:function(e){return new Promise((function(t,a){A.a.delete(P,{data:{_id:e._id}}).then((function(e){e&&e.data&&e.data.message?t(e.data.message):a(new Error("There is no data")),t()})).catch((function(e){a(e)}))}))}},{key:"getLeads",value:function(){return new Promise((function(e,t){a.e(3).then(a.t.bind(null,81,3)).then((function(t){if(t&&t.default){var a=t.default.filter((function(e){return!isNaN(Number(e.lat))&&!isNaN(Number(e.lng))}));console.log("render leads ".concat(a.length)),e(a)}else e([])})).catch((function(e){t(e)}))}))}},{key:"getE5Engineers",value:function(){return new Promise((function(e,t){a.e(4).then(a.t.bind(null,82,3)).then((function(t){if(t&&t.default){var a=t.default.map((function(e){var t,a,n;return{postcode:null===e||void 0===e||null===(t=e.result)||void 0===t?void 0:t.postcode,lat:null===e||void 0===e||null===(a=e.result)||void 0===a?void 0:a.latitude,lng:null===e||void 0===e||null===(n=e.result)||void 0===n?void 0:n.longitude}})).filter((function(e){return!isNaN(Number(e.lat))&&!isNaN(Number(e.lng))}));e(a)}else e([])})).catch((function(e){t(e)}))}))}},{key:"renderE5Engineers",value:function(){var e=Object(y.a)(b.a.mark((function e(){var t,a,n,r=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="e5Engineer",e.prev=1,e.next=4,this.getE5Engineers();case 4:if(!(a=e.sent)||!a.length){e.next=11;break}n=[],a.forEach((function(e){if(e.lat&&e.lng){var a=window.L.marker([e.lat,e.lng],{icon:r.markerIcon(t)}).addTo(r.mapElement);a.bindPopup(r.markerPopupContent(t,e)),n.push(a)}})),this.setState(Object(f.a)({},t,n)),e.next=12;break;case 11:throw new Error("No ".concat(t," to be rendered"));case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),console.error(e.t0),alert("Error while rendering ".concat(t));case 18:case"end":return e.stop()}}),e,this,[[1,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"renderE5EngineerCircles",value:function(){var e=Object(y.a)(b.a.mark((function e(){var t,a,n,r=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="e5Engineer",e.prev=1,e.next=4,this.getE5Engineers();case 4:if(!(a=e.sent)||!a.length){e.next=11;break}n=[],a.forEach((function(e){if(e.lat&&e.lng){var t=window.L.circle([e.lat,e.lng],1609.34,{color:"#000",opacity:1,fillColor:"#000",fillOpacity:1}).addTo(r.mapElement);n.push(t)}})),this.setState(Object(f.a)({},"".concat(t,"Circle"),n)),e.next=12;break;case 11:throw new Error("No ".concat(t," to be rendered"));case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),console.error(e.t0),alert("Error while rendering ".concat(t));case 18:case"end":return e.stop()}}),e,this,[[1,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"renderBoilerJobs",value:function(){var e=Object(y.a)(b.a.mark((function e(){var t,a,n,r,o,i=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="boilerJob",e.prev=1,e.next=4,this.getBoilerJobs();case 4:if(!(a=e.sent)||!a.length){e.next=13;break}r=window.L.markerClusterGroup(),o=[],a.forEach((function(e){if(e.lat&&e.lng){var a=window.L.marker([e.lat,e.lng],{icon:i.markerIcon(t)});a.bindPopup(i.markerPopupContent(t,e)),r.addLayer(a),o.push(a)}})),r.addTo(this.mapElement),this.setState((n={},Object(f.a)(n,"".concat(t,"Cluster"),r),Object(f.a)(n,t,o),n)),e.next=14;break;case 13:throw new Error("No ".concat(t," to be rendered"));case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(1),console.error(e.t0),alert("Error while rendering ".concat(t));case 20:case"end":return e.stop()}}),e,this,[[1,16]])})));return function(){return e.apply(this,arguments)}}()},{key:"renderServiceJobs",value:function(){var e=Object(y.a)(b.a.mark((function e(){var t,a,n,r,o,i=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="serviceJob",e.prev=1,e.next=4,this.getServiceJobs();case 4:if(!(a=e.sent)||!a.length){e.next=13;break}r=window.L.markerClusterGroup(),o=[],a.forEach((function(e){if(e.lat&&e.lng){var a=window.L.marker([e.lat,e.lng],{icon:i.markerIcon(t)});a.bindPopup(i.markerPopupContent(t,e)),r.addLayer(a),o.push(a)}})),r.addTo(this.mapElement),this.setState((n={},Object(f.a)(n,"".concat(t,"Cluster"),r),Object(f.a)(n,t,o),n)),e.next=14;break;case 13:throw new Error("No ".concat(t," to be rendered"));case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(1),console.error(e.t0),alert("Error while rendering ".concat(t));case 20:case"end":return e.stop()}}),e,this,[[1,16]])})));return function(){return e.apply(this,arguments)}}()},{key:"renderLeads",value:function(){var e=Object(y.a)(b.a.mark((function e(){var t,a,n,r,o,i=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="lead",e.prev=1,e.next=4,this.getLeads();case 4:if(!(a=e.sent)||!a.length){e.next=13;break}r=window.L.markerClusterGroup(),o=[],a.forEach((function(e){if(e.lat&&e.lng){var a=window.L.marker([e.lat,e.lng],{icon:i.markerIcon(t)});a.bindPopup(i.markerPopupContent(t,e)),r.addLayer(a),o.push(a)}})),r.addTo(this.mapElement),this.setState((n={},Object(f.a)(n,"".concat(t,"Cluster"),r),Object(f.a)(n,t,o),n)),e.next=14;break;case 13:throw new Error("No ".concat(t," to be rendered"));case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(1),console.error(e.t0),alert("Error while rendering ".concat(t));case 20:case"end":return e.stop()}}),e,this,[[1,16]])})));return function(){return e.apply(this,arguments)}}()},{key:"renderServiceJobsHeatMap",value:function(){var e=Object(y.a)(b.a.mark((function e(){var t,a,n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="serviceJob",e.next=3,this.getServiceJobs();case 3:a=e.sent,n=a.map((function(e){return[e.lat,e.lng,.5]})),r=window.L.heatLayer(n,{radius:10,minOpacity:1}).addTo(this.mapElement),this.setState(Object(f.a)({},"".concat(t,"sHeatMap"),r));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderLeadsHeatMap",value:function(){var e=Object(y.a)(b.a.mark((function e(){var t,a,n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="lead",e.next=3,this.getLeads();case 3:a=e.sent,n=a.map((function(e){return[Number(e.lat),Number(e.lng),.5]})),r=window.L.heatLayer(n,{radius:10,minOpacity:1}).addTo(this.mapElement),this.setState(Object(f.a)({},"".concat(t,"sHeatMap"),r));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderBoilerJobsHeatMap",value:function(){var e=Object(y.a)(b.a.mark((function e(){var t,a,n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="boilerJob",e.next=3,this.getBoilerJobs();case 3:a=e.sent,n=a.map((function(e){return[e.lat,e.lng,.5]})),r=window.L.heatLayer(n,{radius:10,minOpacity:1}).addTo(this.mapElement),this.setState(Object(f.a)({},"".concat(t,"sHeatMap"),r));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"markerPopupContent",value:function(e,t){var a="",n="";return Object.keys(t).forEach((function(e){n+='\n      <tr>\n      <td class="popup-table-row">\n      <td>'.concat(e,"</td>\n      <td>").concat(t[e],"</td>\n      </td>\n        </tr>\n        ")})),n&&(a='\n      <table class="table table-dark">\n      '.concat(n,"\n      </table>\n      ")),a}},{key:"markerIcon",value:function(e){var t="";switch(e){case"e5Engineer":t="https://res.cloudinary.com/razrlab/image/upload/v1571935748/person-marker_wdvvbm.png";break;case"serviceJob":t="https://res.cloudinary.com/razrlab/image/upload/v1571935748/service-marker_tzrx0s.png";break;case"lead":case"boilerJob":t="https://res.cloudinary.com/razrlab/image/upload/v1571935748/home-marker_sskts6.png"}return window.L.icon({iconUrl:t,iconSize:[25,25],iconAnchor:[12,25],popupAnchor:[3,-40]})}},{key:"removeMarkers",value:function(){var e=this;return new Promise((function(t,a){e.removeE5Engineers(),t()}))}},{key:"removeE5EngineerCircles",value:function(){var e=this,t=this.state.e5EngineerCircle;t&&t.length&&t.forEach((function(t){e.mapElement.removeLayer(t)}))}},{key:"removeE5Engineers",value:function(){var e=this,t=this.state.e5Engineer;t&&t.length&&t.forEach((function(t){e.mapElement.removeLayer(t)}))}},{key:"removeServiceJobs",value:function(){var e=this,t=this.state.serviceJob,a=this.state.serviceJobCluster;t&&t.length&&(t.forEach((function(t){e.mapElement.removeLayer(t)})),a&&this.mapElement.removeLayer(a))}},{key:"removeLeads",value:function(){var e=this,t=this.state.lead,a=this.state.leadCluster;t&&t.length&&(t.forEach((function(t){e.mapElement.removeLayer(t)})),a&&this.mapElement.removeLayer(a))}},{key:"removeBoilerJobs",value:function(){var e=this,t=this.state.boilerJob,a=this.state.boilerJobCluster;t&&t.length&&(t.forEach((function(t){e.mapElement.removeLayer(t)})),a&&this.mapElement.removeLayer(a))}},{key:"removeServiceJobsHeatMap",value:function(){var e=this.state.serviceJobsHeatMap;e&&this.mapElement.removeLayer(e)}},{key:"removeLeadsHeatMap",value:function(){var e=this.state.leadsHeatMap;e&&this.mapElement.removeLayer(e)}},{key:"removeBoilerJobsHeatMap",value:function(){var e=this.state.boilerJobsHeatMap;e&&this.mapElement.removeLayer(e)}},{key:"addControls",value:function(){var e=this;window.L.control.custom({position:"bottomleft",content:'\n        <div class="panel-body">\n          <div class="checkbox">\n            <label><input type="checkbox" value="e5Engineers">Rejections</label>\n          </div>\n          <div class="checkbox">\n            <label><input type="checkbox" value="e5EngineerCircles">Rejection Boundaries</label>\n          </div>\n          <div class="checkbox">\n          <label><input type="checkbox" value="leadsHeatMap">Care Homes Heat Map</label>\n          </div>\n          <div class="checkbox">\n            <label><input type="checkbox" value="leads">Care Homes</label>\n          </div>\n        </div>\n        ',classes:"panel panel-default",style:{},events:{click:function(t){if(t&&t.srcElement&&t.srcElement.type)switch(t.srcElement.value){case"leads":t.srcElement.checked?e.renderLeads():e.removeLeads();break;case"leadsHeatMap":t.srcElement.checked?e.renderLeadsHeatMap():e.removeLeadsHeatMap();break;case"e5Engineers":t.srcElement.checked?e.renderE5Engineers():e.removeE5Engineers();break;case"e5EngineerCircles":t.srcElement.checked?e.renderE5EngineerCircles():e.removeE5EngineerCircles()}}}}).addTo(this.mapElement)}},{key:"initEditableLayer",value:function(){this.editableLayers=new window.L.FeatureGroup,this.mapElement.addLayer(this.editableLayers)}},{key:"initDrawControls",value:function(){var e={position:"topright",draw:{polygon:{allowIntersection:!1,drawError:{color:"#e1e100",message:"<strong>Oh snap!<strong> you can't draw that!"},shapeOptions:{color:"#97009c"}},polyline:!1,circle:!1,rectangle:!1,marker:!1},edit:{featureGroup:this.editableLayers,remove:!1}};this.drawControl=new window.L.Control.Draw(e)}},{key:"enablePolygonEditControl",value:function(){var e=this,t=this.mapElement;t.on("draw:created",(function(t){console.log("draw:created");var a=t.layer;e.setState({editPolygonDetails:Object(w.a)(Object(w.a)({},e.state.editPolygonDetails),{},{layer:a}),currentPolygonsInView:[a]}),e.editableLayers.addLayer(a)})),t.on("draw:edited",(function(t){console.log("draw:edited"),t.layers.eachLayer((function(t){e.setState({editPolygonDetails:Object(w.a)(Object(w.a)({},e.state.editPolygonDetails),{},{layer:t}),currentPolygonsInView:[t]})}))})),t.addControl(this.drawControl)}},{key:"disablePolygonEditControl",value:function(){this.drawControl&&this.mapElement.removeControl(this.drawControl)}},{key:"onLoad",value:function(){var e=this;return new Promise((function(t,a){var n=window.L,r=window.$,o=window.config,i=n.control({position:"bottomright"}),s={areas:!1,districts:!1,sectors:!1},l={style:o.shapeStyle,onEachFeature:function(e,t){t.setStyle({fillColor:"rgb("+b(0,256)+","+b(0,256)+","+b(0,256)+")"}),t.bindLabel(e.properties.name,{noHide:!0})}},c=n.geoJson(null,l),u=n.geoJson(null,l),d=n.geoJson(null,l),m=n.tileLayer("http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}?key=AIzaSyC0AJcO-U5RksjP02AQHxEuFlEW5xSKzp8",{maxZoom:20,subdomains:["mt0","mt1","mt2","mt3"]}),h=n.tileLayer(o.openStreetMap.url,{attribution:o.openStreetMap.attribution,maxZoom:o.zoom.max}),p={"Google Maps":m,RAZRMAPS:h},f={Areas:c,Districts:u,Sectors:d},g=n.map("map",{center:[53.21919,-1.86768],zoom:7,layers:[h]}),v=n.control.sidebar("sidebar",{closeButton:!0,position:"left"});function b(e,t){return Math.floor(Math.random()*(t-e))+e}g.addControl(v),e.sidebarElement=v,e.mapElement=g,n.control.layers(p,f,{collapsed:!1}).addTo(g),e.initEditableLayer(),e.initDrawControls(),i.onAdd=function(){var e=n.DomUtil.create("div","control loader");return e.innerHTML='\n              <div>                  Areas... <span id="loadAreas">&#x21BB;</span><br>\n                  Districts... <span id="loadDistricts">&#x21BB;</span><br>\n                  Sectors... <span id="loadSectors">&#x21BB;</span>\n              </div>\n              ',e},i.addTo(g),r.getJSON(o.files.areas,(function(e){c.addData(e.features),g.addLayer(c),s.areas=!0,r("#loadAreas").html("&#x2713;")})).error((function(e){console.error("Failed loading '"+o.files.areas+"'","Error: "+e.statusText),r("#loadAreas").html("&#x2717;")})),r.getJSON(o.files.districts,(function(e){u.addData(e.features),s.districts=!0,r("#loadDistricts").html("&#x2713;")})).error((function(e){console.error("Failed loading '"+o.files.districts+"'","Error: "+e.statusText),r("#loadDistricts").html("&#x2717;")})),r.getJSON(o.files.sectors,(function(e){d.addData(e.features),s.sectors=!0,r("#loadSectors").html("&#x2713;")})).error((function(e){console.error("Failed loading '"+o.files.sectors+"'","Error: "+e.statusText),r("#loadSectors").html("&#x2717;")})),t()}))}},{key:"showSideBar",value:function(){this.sidebarElement.show()}},{key:"hideSideBar",value:function(){this.sidebarElement.hide()}}]),n}(n.Component);function S(){var e=JSON.parse(localStorage.getItem("user"));return e&&e.authdata?{Authorization:"Basic "+e.authdata}:{}}var O={login:function(e,t){var a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})};return fetch("/users/authenticate",a).then(L).then((function(a){return a&&(a.authdata=window.btoa(e+":"+t),localStorage.setItem("user",JSON.stringify(a))),a}))},logout:C,getAll:function(){var e={method:"GET",headers:S()};return fetch("/users",e).then(L)}};function C(){localStorage.removeItem("user")}function L(e){return e.text().then((function(t){var a=t&&JSON.parse(t);if(!e.ok){401===e.status&&(C(),window.location.reload(!0));var n=a&&a.message||e.statusText;return Promise.reject(n)}return a}))}var N=function(e){Object(l.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={user:{},users:[]},n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.setState({user:JSON.parse(localStorage.getItem("user")),users:{loading:!0}}),O.getAll().then((function(t){return e.setState({users:t})}))}},{key:"render",value:function(){var e=this.state;e.user,e.users;return r.a.createElement(x,null)}}]),a}(r.a.Component),j=a(17),D=(a(79),function(e){Object(l.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),n=t.call(this,e),O.logout(),n.state={username:"",password:"",submitted:!1,loading:!1,error:""},n.handleChange=n.handleChange.bind(Object(j.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(j.a)(n)),n}return Object(s.a)(a,[{key:"handleChange",value:function(e){var t=e.target,a=t.name,n=t.value;this.setState(Object(f.a)({},a,n))}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault(),this.setState({submitted:!0});var a=this.state,n=a.username,r=a.password;a.returnUrl;n&&r&&(this.setState({loading:!0}),O.login(n,r).then((function(e){var a=(t.props.location.state||{from:{pathname:"/"}}).from;t.props.history.push(a)}),(function(e){return t.setState({error:e,loading:!1})})))}},{key:"render",value:function(){var e=this.state,t=e.username,a=e.password,n=e.submitted,o=e.loading,i=e.error;return r.a.createElement("div",{className:"login-page"},r.a.createElement("div",{className:"form"},r.a.createElement("h2",null,"Map Analyzer"),r.a.createElement("form",{name:"form",onSubmit:this.handleSubmit},r.a.createElement("div",{className:"form-group"+(n&&!t?" has-error":"")},r.a.createElement("input",{type:"text",className:"form-control",name:"username",value:t,onChange:this.handleChange,placeholder:"Username"}),n&&!t&&r.a.createElement("div",{className:"help-block"},"Username is required")),r.a.createElement("div",{className:"form-group"+(n&&!a?" has-error":"")},r.a.createElement("input",{type:"password",className:"form-control",name:"password",value:a,onChange:this.handleChange,placeholder:"Password"}),n&&!a&&r.a.createElement("div",{className:"help-block"},"Password is required")),r.a.createElement("div",{className:"form-group"},r.a.createElement("button",{className:"btn btn-primary",disabled:o},"Login"),o&&r.a.createElement("img",{src:"data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="})),i&&r.a.createElement("div",{className:"alert alert-danger"},i))))}}]),a}(r.a.Component)),J=function(e){Object(l.a)(a,e);var t=Object(c.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){return r.a.createElement(u.a,null,r.a.createElement("div",null,r.a.createElement(p,{exact:!0,path:"/",component:N}),r.a.createElement(d.b,{path:"/login",component:D})))}}]),a}(r.a.Component);!function(){var e=[{id:1,username:"meerim",password:"meerimTester",firstName:"Test",lastName:"User"}],t=window.fetch;window.fetch=function(a,n){return new Promise((function(r,o){setTimeout((function(){if(a.endsWith("/users/authenticate")&&"POST"===n.method){var i=JSON.parse(n.body),s=e.filter((function(e){return e.username===i.username&&e.password===i.password}));if(s.length){var l=s[0],c={id:l.id,username:l.username,firstName:l.firstName,lastName:l.lastName};r({ok:!0,text:function(){return Promise.resolve(JSON.stringify(c))}})}else o("Username or password is incorrect")}else a.endsWith("/users")&&"GET"===n.method?n.headers&&n.headers.Authorization==="Basic ".concat(window.btoa("meerim:meerimTester"))?r({ok:!0,text:function(){return Promise.resolve(JSON.stringify(e))}}):r({status:401,text:function(){return Promise.resolve()}}):t(a,n).then((function(e){return r(e)}))}),500)}))}}(),Object(o.render)(r.a.createElement(J,null),document.getElementById("root"))}},[[40,1,2]]]);
//# sourceMappingURL=main.7c5dca9a.chunk.js.map